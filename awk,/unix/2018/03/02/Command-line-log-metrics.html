<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Command-line Log Metrics: cat, grep, sed, uniq, sort, wc and awk</title>
  <meta name="description" content="Introduction When troubleshooting software we usually don’t have all the required information in one place. Often we only have command-line access to low lev...">

  <link rel="stylesheet" href="/humanreadable/assets/main.css">
  <link rel="canonical" href="https://mode19.github.io/humanreadable/awk,/unix/2018/03/02/Command-line-log-metrics.html">
  <link rel="alternate" type="application/rss+xml" title="HumanReadable Blog" href="/humanreadable/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-113325585-1', 'auto');
  ga('send', 'pageview');

</script>
  

  

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-113325585-1', 'auto');
	ga('send', 'pageview', { 'page': location.pathname + location.search + location.hash});
	ga('set', 'anonymizeIp', false);
    </script>
    <!-- End Google Analytics -->
    </head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/humanreadable/">HumanReadable Blog</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/humanreadable/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Command-line Log Metrics: cat, grep, sed, uniq, sort, wc and awk</h1>
    <p class="post-meta">
      <time datetime="2018-03-02T00:00:00+00:00" itemprop="datePublished">
        
        Mar 2, 2018
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>
<p>When troubleshooting software we usually don’t have all the required information in one place. Often we only have command-line access to low level application and system log files.
  Command line tools such as tail, cat, grep etc. can be combined to provide basic insights into application performance.
Lets look at some examples of how to use standard UNIX command-line tools to analyze application log files.</p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>Be comfortable using the UNIX command line utilities such as <a href="https://en.wikipedia.org/wiki/Cat_(Unix)">cat</a>, <a href="https://en.wikipedia.org/wiki/Tail_(Unix)">tail</a>, <a href="https://en.wikipedia.org/wiki/Grep">grep</a> etc.</li>
  <li>Have access to the calc.sh (or some alternative) script which can calculate average/median/minimum and maximum times. See the corresponding guide <a href="https://mode19.github.io/humanreadable/awk,/unix/2018/03/01/Quick-and-dirty-software-metrics-using-awk.html">Quick and Dirty Software Metrics using Awk</a></li>
</ul>

<h2 id="why">Why?</h2>

<p>Lets look at real world situation: a customer has complained that some operations in the system are taking too long. Luckily the developer included some logging in the application that records how long each operation takes. If we view the log file directly we can see an entry for every event that occurred. Now imagine this log contains thousands or millions of records? How will we identify which events are being triggered in the system? How frequently are certain types of events occurring? How long does each type of event take to process (Average, minimum, maximum time etc)? The below guide is a step by step example of how to calculate these kinds of metrics.</p>

<p>Imagine a logfile that looks as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2018-03-03 12:00:14 SOFTWAREPROGRAM MODULE DEBUG [sessiony] processing event #1 took 20440 ms
2018-03-03 12:00:15 SOFTWAREPROGRAM MODULE INFO [sessionx] processing event #1 took 20440 ms
2018-03-03 12:00:16 SOFTWAREPROGRAM MODULE DEBUG [sessiony] processing event #1 took 20440 ms
2018-03-04 12:00:24 SOFTWAREPROGRAM MODULE ERROR [sessionx] processing event #1 took 20440 ms
2018-03-04 12:01:04 SOFTWAREPROGRAM MODULE DEBUG [sessiony] processing event #1 took 16628 ms
2018-03-04 12:02:53 SOFTWAREPROGRAM MODULE DEBUG [sessionx] processing event #0 took 11418 ms
2018-03-04 12:03:00 SOFTWAREPROGRAM MODULE INFO [sessiony] processing event #1 took 28995 ms
2018-03-04 12:04:44 SOFTWAREPROGRAM MODULE DEBUG [sessionx] processing event #1 took 28166 ms
2018-03-04 12:04:44 SOFTWAREPROGRAM MODULE DEBUG [sessiony] processing event #0 took 26063 ms
2018-03-04 12:04:44 SOFTWAREPROGRAM MODULE INFO [sessionx] processing event #1 took 27168 ms
2018-03-04 12:07:31 SOFTWAREPROGRAM MODULE DEBUG [sessionz] processing event #0 took 30484 ms
2018-03-04 12:08:44 SOFTWAREPROGRAM MODULE DEBUG [sessionx] processing event #1 took 27769 ms
2018-03-04 12:09:07 SOFTWAREPROGRAM MODULE DEBUG [sessionz] processing event #1 took 16378 ms

</code></pre></div></div>
<h2 id="filtering-and-counting-events">Filtering and Counting Events</h2>

<p>When faced with thousands of records, the first step is to filter out the records we are not interested in.  We do this by identifying a set of specific key words that we are interested in, and we chose these key words so that they uniquely identify the event we are interested.  For example, searching for “event #1” might also match “event #11”, so in order to uniquely identify “\sevent #1\s” we would have to also include the surrounding white-space as part of the matching expression. In this example only 2 events so we can safely filter “event #1”. See the examples below to filter out unwanted records by using <a href="https://en.wikipedia.org/wiki/Cut_(Unix)">grep</a> and counting the remaining ones using the <a href="https://en.wikipedia.org/wiki/Wc_(Unix)">wc</a> utility .</p>

<p>How many events happened on March 3rd?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt  | grep "2018-03-03" | wc -l
3
</code></pre></div></div>

<p>How many events happened on March 2nd?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt  | grep "2018-03-02" | wc -l
0
</code></pre></div></div>

<p>How many events of type “event #1” happened on March 4th?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt  | grep "2018-03-04" | grep "event #1" | wc -l
7
</code></pre></div></div>

<p>How many events happened for sessionz on March 4th?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt  | grep "2018-03-04" | grep "event #1 " | grep "\[sessionz\]" | wc -l
1
</code></pre></div></div>

<p>N.B Notice the regular expression to match the session identifier sessionz includes the surround delimiters.  This avoids situations where sessionz could become a false positive for sessionzz or sessionz1 etc.</p>

<h2 id="cutting-and-counting">Cutting and Counting</h2>

<p>We can use the <a href="https://en.wikipedia.org/wiki/Cut_(Unix)">cut</a> command to isolate specific fields.  This way we can aggregate data over specific groups such as time. Using the <a href="https://en.wikipedia.org/wiki/Sort_(Unix)">sort</a> and <a href="https://en.wikipedia.org/wiki/Uniq">uniq</a> utilities we can count the unique number of occurrences of each event by group.</p>

<p>For example, how many events are happening per day?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt | cut -f1 -d" " | sort | uniq -c
3 2018-03-03
10 2018-03-04
</code></pre></div></div>

<p>How many events are happening per second?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt | cut -d " " -f1,2   | uniq -c
1 2018-03-03 12:00:14
1 2018-03-03 12:00:15
1 2018-03-03 12:00:16
1 2018-03-04 12:00:24
1 2018-03-04 12:01:04
1 2018-03-04 12:02:53
1 2018-03-04 12:03:00
3 2018-03-04 12:04:44
1 2018-03-04 12:07:31
1 2018-03-04 12:08:44
1 2018-03-04 12:09:07
</code></pre></div></div>

<h2 id="what-is-the-average-processing-time-of-event-0">What is the Average Processing Time of Event #0?</h2>

<p>In order to isolate the log entries containing “event #0” and identifying only the processing time we can produce a list of all corresponding processing times.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt  | grep "event #0 "
2018-03-04 12:2:53 SOFTWAREPROGRAM MODULE DEBUG processing event #0 took 11418 ms
2018-03-04 12:5:21 SOFTWAREPROGRAM MODULE DEBUG processing event #0 took 26063 ms
2018-03-04 12:7:31 SOFTWAREPROGRAM MODULE DEBUG processing event #0 took 30484 ms
</code></pre></div></div>

<p>What are just the response times? Using the <a href="https://en.wikipedia.org/wiki/Sed">sed</a> utility substitution command to replace the entire line with only the portion in between the word ‘took ‘ and the word ‘ ms’:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.txt  | grep "event #0" | sed -ne 's/.*took \([0-9]*\) ms/\1/p'
11418
26063
30484
</code></pre></div></div>

<p>Now how do we make sense of this data?  Especially if the result contains hundreds or thousands of records, how can we begin to understand the data?  One quick way is to calculate the average, minimum and maximum values.  This can be done using an awk script (For details on the calc.sh script reference the blog post <a href="https://mode19.github.io/humanreadable/awk,/unix/2018/03/01/Quick-and-dirty-software-metrics-using-awk.html">here</a>):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat logfile.text | grep "event #0" | sed -ne 's/.*took \([0-9]*\) ms/\1/p' | ~/bin/calc.sh
sum     count   average medium  min     max
67965   3       22655   26063   11418   30484
</code></pre></div></div>

<h2 id="conclusion-and-next-steps">Conclusion and Next Steps</h2>

<p>Using these techniques we can analyze large log files to search for specific values or events. These techniques can work when querying a single file or combining multiple files together. Also, since these techniques are done on the command-line they can be easily scripts and repeated or executed in an automated fashion.  With a few basic scrips one can develop sophisticated techniques for measuring software metrics. Check back for future articles on how to take these metrics and seamlessly create graphs using the gnuplot command-line utility.</p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">HumanReadable Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              HumanReadable Blog
            
            </li>
            
            <li><a href="mailto:mode19software@gmail.com">mode19software@gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/mode19"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">mode19</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Computers, Linux, open-source, programming, technology and related articles</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
